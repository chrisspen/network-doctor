name: CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  shellcheck:
    name: Shellcheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run shellcheck
        run: |
          shellcheck network-doctor.sh install.sh uninstall.sh build-deb.sh publish.sh status.sh logs.sh

  test:
    name: Bats Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install bats
        run: |
          sudo apt-get update
          sudo apt-get install -y bats

      - name: Run tests
        run: bats test/

  build:
    name: Build Package
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build .deb package
        run: |
          VERSION=0.0.0-test ./build-deb.sh

      - name: Verify package
        run: |
          dpkg-deb --info dist/network-doctor_0.0.0-test_all.deb
          dpkg-deb --contents dist/network-doctor_0.0.0-test_all.deb
